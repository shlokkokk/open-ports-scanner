<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Ethical Port Scanner | Cyberpunk AF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  :root{--bg:#000;--glow:#0f0;--accent:#f0f;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--glow);font-family:'Share Tech Mono',monospace;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;cursor:none;}
  #matrix{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;}
  .scanline{position:fixed;top:0;left:0;width:100%;height:3px;background:var(--glow);opacity:.4;animation:scan 2s linear infinite;z-index:5;}
  @keyframes scan{0%{transform:translateY(0);}100%{transform:translateY(100vh);}}
  h1{font-size:3rem;text-shadow:0 0 5px var(--glow),0 0 10px var(--glow),0 0 20px var(--accent);animation:glitch 1.5s infinite;}
  @keyframes glitch{0%,100%{text-shadow:0 0 5px var(--glow),0 0 10px var(--glow),0 0 20px var(--accent);}20%{text-shadow:0 0 5px var(--accent),0 0 10px var(--accent),0 0 20px var(--glow);}40%{text-shadow:0 0 5px var(--glow),0 0 10px var(--glow),0 0 20px var(--accent);}60%{text-shadow:0 0 5px var(--accent),0 0 10px var(--accent),0 0 20px var(--glow);}}
  .box{background:#111a;border:1px solid var(--glow);padding:2.5rem;border-radius:12px;box-shadow:0 0 30px var(--glow);z-index:10;}
  input,button{font-family:inherit;font-size:1rem;padding:.7rem 1.2rem;border-radius:6px;border:none;outline:none;transition:.2s;}
  input{background:#000;color:var(--glow);border:1px solid var(--glow);width:435px;}
  button{background:var(--glow);color:#000;margin-left:.5rem;cursor:pointer;}
  button:hover{background:#0a0;box-shadow:0 0 15px var(--glow);}
  #out{margin-top:1.5rem;max-width:700px;white-space:pre-wrap;font-size:.9rem;line-height:1.4;}
  #genBtn{display:none;margin-top:1rem;}
  /* mouse lightning */
  .bolt{position:fixed;width:2px;height:2px;background:var(--glow);box-shadow:0 0 10px 3px var(--glow);pointer-events:none;z-index:9999;border-radius:50%;}
</style>
</head>
<body>
<canvas id="matrix"></canvas>
<div class="scanline"></div>
<div class="box">
  <h1>[ ETHICAL PORT SCANNER ]</h1>
  <div>
    <input id="tgt" placeholder="URL or IP  (e.g. example.com  or  192.168.1.1)">
    <button onclick="scan()">INITIATE FULL SCAN</button>
  </div>
  <div id="out"></div>
  <button id="genBtn" onclick="genPDF()">GENERATE PDF REPORT</button>
</div>

<script>
// matrix rain
const canvas=document.getElementById('matrix');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
const cols=Math.floor(canvas.width/20);
const drops=Array(cols).fill(1);
const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");
function draw(){
  ctx.fillStyle='rgba(0,0,0,0.05)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#0f0';
  ctx.font='15px Share Tech Mono';
  drops.forEach((y,i)=>{
    const text=chars[Math.floor(Math.random()*chars.length)];
    ctx.fillText(text,i*20,y*20);
    if(y*20>canvas.height&&Math.random()>.95) drops[i]=0;
    drops[i]++;
  });
}
setInterval(draw,50);

// mouse lightning
document.addEventListener('mousemove',e=>{
  let b=document.createElement('div');
  b.className='bolt';
  b.style.left=e.clientX+'px';
  b.style.top=e.clientY+'px';
  document.body.appendChild(b);
  setTimeout(()=>b.remove(),300);
});

// scanner logic (unchanged URLs)
let scanData={};
async function scan(ev){
  const tgt=document.getElementById('tgt').value.trim();
  if(!tgt){alert('Enter hostname');return;}
  const o=document.getElementById('out');
  const gen=document.getElementById('genBtn');
  o.textContent='Scanning 1-65535 (async) â€¦';
  gen.style.display='none';
  const res=await fetch('/scan',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({target:tgt})});
  const data=await res.json();
  if(data.error){o.textContent='Error: '+data.error;return;}
  scanData=data;
  let txt=`Target resolved: ${data.ip}\n\n`;
  if(data.open.length===0){txt+='No open ports found.  Stay frosty.';}
  else{
    txt+=`Open ports found: ${data.open.length}\n\n`;
    for(const p of data.open){
      const svc=data.service[p];
     const atk=data.attack[p];
     const fix=data.fix[p];
     txt+=`Port ${p} (${svc})\n`;
     txt+=`  Attack: ${atk}\n`;
     txt+=`  Fix   : ${fix}\n\n`;
}
  }
  o.textContent=txt;
  gen.style.display='inline-block';
}
async function genPDF(){
  const {ip,open}=scanData;
  const res=await fetch('/report',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ip,open})
  });
  const blob=await res.blob();
  // force correct MIME & download
  const url=window.URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.style.display='none';
  a.href=url;
  a.download=`scan_${ip}.pdf`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  window.URL.revokeObjectURL(url);
}
</script>
</body>
</html>